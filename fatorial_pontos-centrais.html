<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Adição de pontos centrais em planejamentos 2^k</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-66454501-9"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-66454501-9');
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CE074</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="aulas.html">
    <span class="fa fa-calendar"></span>
     
    Calendário
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file"></span>
     
    Materiais
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="divider"></li>
    <li class="dropdown-header">Introdução e revisão</li>
    <li>
      <a href="slides-pdf/00-intro.pdf">Visão geral [PDF]</a>
    </li>
    <li>
      <a href="slides-pdf/01-planej-revisao.pdf">Princípios e definições [PDF]</a>
    </li>
    <li>
      <a href="slides-pdf/03-intro-fatoriais.pdf">Intro. experimentos fatoriais [PDF]</a>
    </li>
    <li>
      <a href="catalizando-conhecimento.html">Catalizando a geração de conhecimento [HTML]</a>
    </li>
    <li>
      <a href="modelos-lineares.html">Modelos lineares e reparametrizações [HTML]</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Experimentos fatoriais</li>
    <li>
      <a href="anova-geral.html">ANOVA por meio de Diagramas de Hasse [HTML]</a>
    </li>
    <li>
      <a href="fatorial_2-2.html">Experimentos fatorias 2^2 [HTML]</a>
    </li>
    <li>
      <a href="fatorial_2-3.html">Experimentos fatorias 2^3 [HTML]</a>
    </li>
    <li>
      <a href="fatorial_2-k.html">Experimentos fatorias 2^k, k &gt; 3 [HTML]</a>
    </li>
    <li>
      <a href="fatorial_pontos-centrais.html">Adição de pontos centrais em planejamentos 2^k [HTML]</a>
    </li>
    <li>
      <a href="confundimento-blocagem.html">Técnicas de confundimento para blocagem em fatorias 2^k [HTML]</a>
    </li>
    <li>
      <a href="fatorial_fracionado.html">Experimentos fatorias fracionados 2^{k-p} [HTML]</a>
    </li>
    <li>
      <a href="msr.html">Metodologia de Superfície de Resposta [HTML]</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Scripts</li>
    <li>
      <a href="scripts/script_racoes_pimentel.R">Tipos de contrastes em modelos lineares [R]</a>
    </li>
    <li>
      <a href="scripts/script_catalisador.R">Interpretação de efeitos estimados em modelos lineares [R]</a>
    </li>
    <li>
      <a href="scripts/script_fatorial_2-2.R">Análise completa de um fatorial 2^2 [R]</a>
    </li>
    <li>
      <a href="scripts/script_fatorial_2-6.R">Análise completa de um fatorial 2^6 [R]</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Experimento</li>
    <li>
      <a href="instrucoes-planejamento.html">Instruções para o planejamento de experimentos [HTML]</a>
    </li>
    <li>
      <a href="misc/guia-planejamento.html">Guia para o planejamento de experimentos [HTML]</a>
    </li>
    <li>
      <a href="misc/guia-planejamento.Rmd">Guia para o planejamento de experimentos [Rmd]</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Exercícios</li>
    <li>
      <a href="exercicios/ex_revisao.pdf">Revisão de conhecimento [PDF]</a>
    </li>
    <li>
      <a href="exercicios/ex_fatorial.pdf">Experimentos fatoriais [PDF]</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-terminal"></span>
     
    Scripts R
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./scripts/anova-fat-matrizes.R">Anova matricial para fatorial</a>
    </li>
    <li>
      <a href="./scripts/fatorial-duplo-geral.R">Análise de fatorial duplo geral</a>
    </li>
    <li>
      <a href="./scripts/fatorial-2k.R">Análise de fatorial 2^k^</a>
    </li>
    <li>
      <a href="./scripts/gerar-2k-conf-blocos.R">Confundimento com blocos em 2^k^</a>
    </li>
    <li>
      <a href="http://bcs.wiley.com/he-bcs/Books?action=resource&amp;bcsId=7009&amp;itemId=1118146921&amp;resourceId=26715">Datasets do Montgomery 8th edição</a>
    </li>
  </ul>
</li>
<li>
  <a href="referencias.html">
    <span class="fa fa-book"></span>
     
    Referências
  </a>
</li>
<li>
  <a href="recursos.html">
    <span class="fa fa-wrench"></span>
     
    Recursos
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leg-ufpr/ce074">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Adição de pontos centrais em planejamentos <span class="math inline">\(2^k\)</span></h1>

</div>


<div id="introducao" class="section level1">
<h1>Introdução</h1>
<p>Nos experimentos <span class="math inline">\(2^k\)</span>, pelo fato de usarmos apenas 2 níveis de cada fator, estamos automaticamente assumindo que a relação de dependência da resposta para os fatores é linear. Existe então uma preocupação sobre essa suposição de linearidade.</p>
<p>Podemos notar que, ao se adicionar um <strong>termo de interação</strong> à um modelo de efeitos principais de <strong>primeira ordem</strong>, resultando em</p>
<ol class="example" style="list-style-type: decimal">
<li><span class="math display">\[
y = \beta_0 + \sum_{j=1}^{k} \beta_{j} x_j +
\mathop{\sum\sum}\limits_{i &lt; j} \beta_{ij} x_i x_j +
\epsilon
\]</span></li>
</ol>
<p>então temos um modelo capaz de representar uma curvatura na variável resposta. Essa curvatura é resultado da “torção” no plano induzida pelos termos da interação <span class="math inline">\(\beta_{ij} x_i x_j\)</span>.</p>
<p>No entanto, podem existir situações onde a curvatura na variável resposta não é modelada adequadamente pela equação (1) acima. Nestes casos, devemos considerar um modelo com</p>
<ol start="2" class="example" style="list-style-type: decimal">
<li><span class="math display">\[
y = \beta_0 + \sum_{j=1}^{k} \beta_{j} x_j +
\mathop{\sum\sum}\limits_{i &lt; j} \beta_{ij} x_i x_j +
\sum_{j=1}^{k} \beta_{jj} x_{j}^{2} +
\epsilon
\]</span></li>
</ol>
<p>onde <span class="math inline">\(\beta_{jj}\)</span> representa <strong>efeitos quadráticos</strong> ou de <strong>segunda ordem</strong>. Este modelo também é chamado de <strong>superfície de resposta de segunda ordem</strong>.</p>
<p>Uma forma de testar se existe curvatura (“proteção contra curvatura”) é através da <strong>adição de pontos centrais</strong> ao planejamento <span class="math inline">\(2^k\)</span>. Como o próprio nome sugere, esses pontos serão os valores (0, 0) na escala codificada dos níveis (-1, 1). Portanto, o processo consiste em realizar <span class="math inline">\(n_c\)</span> réplicas no ponto <span class="math inline">\(x_i = 0\)</span>, (<span class="math inline">\(i = 1, 2, \ldots, k\)</span>). Uma razão importante para adicionar as corridas replicadas no centro do planejamento, é que pontos centrais não interferem nas estimativas dos efeitos de planejamentos <span class="math inline">\(2^k\)</span>. Quando adicionamos os pontos centrais, consideramos que os <span class="math inline">\(k\)</span> fatores são quantitativos.</p>
<p>Para ilustrar a abordagem, considere um experimento <span class="math inline">\(2^2\)</span> com uma observação em cada um dos pontos fatoriais: (-,-), (+,-), (-,+), (+,+), e <span class="math inline">\(n_c\)</span> observações nos pontos centrais (0,0). Seja <span class="math inline">\(\bar{y}_F\)</span> a média das quatro corridas nos quatro pontos fatoriais, e <span class="math inline">\(\bar{y}_C\)</span> a média das <span class="math inline">\(n_C\)</span> corridas no ponto central. Se a diferença <span class="math inline">\(\bar{y}_F - \bar{y}_C\)</span> for pequena, os pontos centrais estarão no plano ou próximo do plano passando através dos pontos fatoriais, não havendo portanto curvatura. Por outro lado, se <span class="math inline">\(\bar{y}_F - \bar{y}_C\)</span> for grande, então há indícios de que existe curvatura. A <strong>soma de quadrados da curvatura</strong>, com <strong>um grau de liberdade</strong> é dada por</p>
<ol start="3" class="example" style="list-style-type: decimal">
<li><span class="math display">\[
\begin{align}
SQ_{curv} &amp;= \left( \frac{\bar{y}_F - \bar{y}_C}{\sqrt{\frac{1}{n_F} +
\frac{1}{n_C}}} \right)^2 \\
          \\
&amp;= \frac{n_F n_C (\bar{y}_F - \bar{y}_C)^2}{n_F + n_C}
\end{align}
\]</span></li>
</ol>
<p>onde <span class="math inline">\(n_F\)</span> é o número de pontos do planejamento fatorial. Essa soma de quadrados deve ser comparada com a média quadrática do erro (como existe um grau de liberdade, então <span class="math inline">\(SQ_{curv} = MQ_{curv}\)</span>) para testar a curvatura. Note que quando a equação (3) acima for dividida por <span class="math inline">\(\hat{\sigma}^2 = MQ_{Res}\)</span>, o resultado será similar ao quadrado da estatística <span class="math inline">\(t\)</span> usada para comparar duas médias, o que equivale a um teste F.</p>
<p>Mais especificamente, quando pontos centrais são adicionados à um experimento <span class="math inline">\(2^k\)</span>, então o teste para curvatura (usando a equação acima) realmente testa as hipóteses</p>
<p><span class="math display">\[
\begin{align}
\text{H}_0 &amp;: \sum_{j=1}^{k} \beta_{jj} = 0 \\
\text{H}_1 &amp;: \sum_{j=1}^{k} \beta_{jj} \neq 0
\end{align}
\]</span></p>
<p>Além disso, se os pontos fatoriais do planejamento não forem replicados, poderemos usar os <span class="math inline">\(n_C\)</span> pontos centrais para construir uma <strong>estimativa de erro</strong> com <span class="math inline">\(n_C - 1\)</span> graus de liberdade (chamado de “erro puro”).</p>
<p>Com a adição de pontos centrais é possível ter uma estimativa de erro (variância) pura, ou seja, que independe do modelo especificado. A idéia básica é <strong>decompor a soma de quadrados dos resíduos</strong> em soma de quadrado <strong>pura</strong> e soma de quadrados devido à <strong>falta de ajuste</strong>.</p>
<p>O teste da falta de ajuste é importante para situar-se na região experimental. No caso de não haver falta de ajuste entende-se que o modelo de primeira ordem (1) que estima efeitos principais e interações apenas, é adequado para descrever o fenômeno. Por outro lado, a existência de falta de ajuste indica que para pelo menos um dos <span class="math inline">\(k\)</span> fatores existe uma relação não linear e que este fator está perto da sua região experimental ótima (isso será melhor explorado na metodologia de superfície de resposta).</p>
<p>Quando isso acontecer, os próximos experimentos devem ser planejados de forma a pertimitir estimação de termos quadráticos para capturar essa não linearidade da relação <span class="math inline">\(y \sim x_1 + x_2 + \cdots + x_k\)</span> bem como permitir encontrar pontos de ótimo da relação, que é o nosso objetivo principal.</p>
</div>
<div id="sobre-a-falta-de-ajuste-em-modelos-lineares" class="section level1">
<h1>Sobre a falta de ajuste em modelos lineares</h1>
<p>De maneira geral, para verificar se o modelo linear é adequado para descrever a relação entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span>, devemos realizar um teste para <strong>falta de ajuste</strong>.</p>
<p>A falta de ajuste pode ser verificada quando existem medições repetidas de <span class="math inline">\(Y\)</span> para um certo nível de <span class="math inline">\(X\)</span>. Por exemplo, se <span class="math inline">\(X_i\)</span> for considerada em uma escala discreta com <span class="math inline">\(k\)</span> níveis (<span class="math inline">\(i = 1, 2, \ldots, k\)</span>), podemos observar <span class="math inline">\(n_i\)</span> repetições de <span class="math inline">\(Y_{ij}\)</span> (<span class="math inline">\(j = 1, 2, \ldots, n_i\)</span>).</p>
<p>No caso específico de um experimento fatorial <span class="math inline">\(2^2\)</span>, por exemplo, temos o fator <span class="math inline">\(A\)</span> com 2 níveis, <span class="math inline">\(B\)</span> com 2 níveis, onde cada nível (<span class="math inline">\(-1\)</span> e <span class="math inline">\(1\)</span>) são os pontos na escala discreta. Considere que não há repetições, então existem apenas quatro observações deste experimento fatorial. Com a adição de um ponto central (<span class="math inline">\(0,0\)</span>), geralmente temos <span class="math inline">\(n_C\)</span> repetições, que seriam as medidas repetidas para este ponto.</p>
<p>Quando existem repetições, é possível calcular o <strong>erro puro</strong>, ou seja, o desvio de cada observação <span class="math inline">\(Y_{ij}\)</span>, com relação à média do nível <span class="math inline">\(i\)</span>, <span class="math inline">\(\bar{y}_i\)</span>.</p>
<p>Novamente fazendo associação com um experimento fatorial com ponto central, nós podemos usar as medidas repetidas do ponto central para estimar o erro experimental. Note que esta é uma <strong>grande vantagem</strong> da adição de pontos centrais, pois mesmo em experimentos fatorias onde não há repetições para os pontos dos fatores, se houver medidas repetidas apenas no ponto central, podemos ter uma estimativa do erro.</p>
<p>Note que <strong>o erro puro não depende de nenhum modelo</strong>, pois mede apenas os desvios das observações em relação à média. Por esse motivo, ele pode ser comparado com os desvios de um modelo de regressão para verificação da qualidade do ajuste. A ideia é que se o modelo linear é adequado, então os desvios das observações em relação à média (erro puro) devem ser próximos dos desvios das observações em relação ao modelo ajustado.</p>
<p>Se não houverem repetições nos níveis de <span class="math inline">\(X_i\)</span> (ou no ponto central), então a suposição de linearidade deve ser verificada através dos resíduos do modelo apenas. (Mesmo com a realização de um teste de falta de ajuste, os resíduos sempre devem ser verificados).</p>
<p>Para representar o erro puro e a falta de ajuste, podemos realizar a decomposição da soma de quadrados dos resíduos, quando existem repetições para <span class="math inline">\(X_i\)</span>, em</p>
<p><img src="img/lof.png" width="60%" style="display: block; margin: auto;" /></p>
<p><span class="math display">\[
\begin{align}
A &amp;= B + C \\
(y_{ij} - \hat{y}_i) &amp;= (y_{ij} - \bar{y}_i) + (\bar{y}_i - \hat{y}_i) \\
\text{Resíduo} &amp;= \text{Erro puro} + \text{Desvio de regressão (falta de
ajuste)}
\end{align}
\]</span></p>
<p>Fazendo a soma de quadrados destes termos, temos</p>
<p><span class="math display">\[
\begin{align}
\sum_{i=1}^{k}\sum_{j=1}^{n_i} (y_{ij} - \hat{y}_i)^2 &amp;=
    \sum_{i=1}^{k}\sum_{j=1}^{n_i} (y_{ij} - \bar{y}_i)^2 +
    \sum_{i=1}^{k}\sum_{j=1}^{n_i} (\bar{y}_i - \hat{y}_i)^2 \\
 &amp;=
    \sum_{i=1}^{k}\sum_{j=1}^{n_i} (y_{ij} - \bar{y}_i)^2 +
    \sum_{i=1}^{k} n_i (\bar{y}_i - \hat{y}_i)^2
\end{align}
\]</span></p>
<p>Com isso, podemos ver que um modelo “bom” (onde a suposição de linearidade é adequada), será aquele em que a falta de ajuste (ou desvio de regressão), será próxima de zero, pois em um modelo correto, esperamos que</p>
<p><span class="math display">\[
\hat{y}_i = \bar{y}_i
\]</span></p>
<p>Com isso, se o modelo for correto, então <span class="math inline">\(QMRes\)</span> provê uma estimativa não viesada para <span class="math inline">\(\sigma^2\)</span>. Se o modelo for incorreto, então <span class="math inline">\(QMRes\)</span> será uma estimativa viesada para <span class="math inline">\(\sigma^2\)</span>, pois haverá um desvio sistemático (viés) entre o modelo correto (desconhecido), e o modelo incorreto utilizado:</p>
<p><span class="math display">\[
\sigma^2 + \text{B}_i
\]</span></p>
<p>onde</p>
<p><span class="math display">\[
\text{B}_i = \text{E}(Y_i) - \text{E}(\hat{Y}_i)
\]</span></p>
<p>é o viés. Usar o modelo incorreto, levará, portanto, à estimativas viciadas das variâncias dos estimadores, e por consequência, os intervalos de confiança e os testes de hipótese serão incorretos.</p>
<p>Faz sentido então, testarmos as hipóteses</p>
<p><span class="math display">\[
\begin{align}
\text{H}_0 &amp;: \text{o modelo é adequado (não há falta de ajuste)} \\
\text{H}_1 &amp;: \text{o modelo não é adequado (há falta de ajuste)}
\end{align}
\]</span></p>
<p>com base na <span class="math inline">\(SQep\)</span> (soma de quadrados do erro puro) e <span class="math inline">\(SQlof\)</span> (soma de quadrados da falta de ajuste). Como já vimos, a <span class="math inline">\(SQep\)</span> é calculada como</p>
<p><span class="math display">\[
SQep = \sum_{i=1}^{k}\sum_{j=1}^{n_i} (y_{ij} - \bar{y}_i)^2
\]</span></p>
<p>com <span class="math inline">\((n-k)\)</span> graus de liberdade, pois são necessárias <span class="math inline">\(k\)</span> médias para o cálculo. No caso do experimento fatorial <span class="math inline">\(2^2\)</span> com <span class="math inline">\(n_C\)</span> pontos centrais, esta soma de quadrados é</p>
<p><span class="math display">\[
SQep = \sum_{i=1}^{n_C} (y_{i} - \bar{y}_C)^2
\]</span></p>
<p>onde <span class="math inline">\(\bar{y}_C\)</span> é a média dos pontos centrais. Como aqui só há uma média, então existem <span class="math inline">\(n_C - 1\)</span> graus de liberdade.</p>
<p>Como vimos na equação (3) acima, a soma de quadrados da curvatura, ou da falta de ajuste, é</p>
<p><span class="math display">\[
SQ_{curv} = \frac{n_F n_C (\bar{y}_F - \bar{y}_C)^2}{n_F + n_C}
\]</span></p>
<p>com um grau de liberdade. Com isso, a hipótese pode ser testada com</p>
<p><span class="math display">\[
\frac{SQcurv/1}{SQep/(n_C - 1)} = \frac{MQcurv}{MQep}
\]</span></p>
<p>que, sob <span class="math inline">\(H_0\)</span>, possui distribuição <span class="math inline">\(F\)</span> com <span class="math inline">\(1\)</span>, e <span class="math inline">\(n_C - 1\)</span> graus de liberdade.</p>
</div>
<div id="exemplos" class="section level1">
<h1>Exemplos</h1>
<div id="fatorial-22-5-pontos-centrais" class="section level2">
<h2>Fatorial <span class="math inline">\(2^2\)</span> + 5 pontos centrais</h2>
<pre class="r"><code>##----------------------------------------------------------------------
## Importação e definições
url &lt;- &quot;http://www.leg.ufpr.br/~fernandomayer/data/montgomery_14-6.csv&quot;
dados &lt;- read.csv(url)
str(dados)
# &#39;data.frame&#39;: 9 obs. of  3 variables:
#  $ Tempo      : int  -1 1 -1 1 0 0 0 0 0
#  $ Temperatura: int  -1 -1 1 1 0 0 0 0 0
#  $ Rendimento : num  39.3 40.9 40 41.5 40.3 40.5 40.7 40.2 40.6
## Definições
k &lt;- 2
a &lt;- b &lt;- 2
r &lt;- 1
n &lt;- r*2^k

##----------------------------------------------------------------------
## Análise exploratória
with(subset(dados, Tempo != 0),
     interaction.plot(Tempo, Temperatura, Rendimento))
with(subset(dados, Tempo == 0),
            points(x = 1.5, y = mean(Rendimento), pch = 16, col = 2))</code></pre>
<p><img src="figures/mont146-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>wireframe(Rendimento ~ Tempo + Temperatura, data = dados, drape = TRUE)</code></pre>
<p><img src="figures/mont146-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
##----------------------------------------------------------------------
## Montando a tabela de sinais
tab &lt;- model.matrix(~ Tempo * Temperatura, data = dados)
tab
#   (Intercept) Tempo Temperatura Tempo:Temperatura
# 1           1    -1          -1                 1
# 2           1     1          -1                -1
# 3           1    -1           1                -1
# 4           1     1           1                 1
# 5           1     0           0                 0
# 6           1     0           0                 0
# 7           1     0           0                 0
# 8           1     0           0                 0
# 9           1     0           0                 0
# attr(,&quot;assign&quot;)
# [1] 0 1 2 3

##----------------------------------------------------------------------
## Cálculo dos contrastes e efeitos
## Contrastes
(contr &lt;- t(tab[, -1]) %*% dados$Rendimento)
#                   [,1]
# Tempo              3.1
# Temperatura        1.3
# Tempo:Temperatura -0.1
## Efeitos
(ef &lt;- contr/(r*2^(k-1)))
#                    [,1]
# Tempo              1.55
# Temperatura        0.65
# Tempo:Temperatura -0.05</code></pre>
<p>Note que os pontos centrais, por serem definidos no ponto (0,0) não são considerados efeitos, e por isso não são estimados.</p>
<p>O teste manual para falta de ajuste pode ser feito da seguinte forma:</p>
<pre class="r"><code>## Separa os pontos fatoriais dos centrais e calcula tamanho das
## amostras
yf &lt;- dados$Rendimento[dados$Tempo != 0] # y dos pontos fatoriais
yc &lt;- dados$Rendimento[dados$Tempo == 0] # y do ponto central (0,0)
(nf &lt;- length(yf))
# [1] 4
(nc &lt;- length(yc))
# [1] 5
## Médias
c(mean(yf), mean(yc))
# [1] 40.425 40.460
diff(c(mean(yf), mean(yc)))
# [1] 0.035</code></pre>
<p>A SQ do erro puro mede a distância das observações do ponto central em relação à sua média</p>
<pre class="r"><code>(SQpuro &lt;- sum((yc - mean(yc))^2))
# [1] 0.172</code></pre>
<p>Como só existe uma média, então essa SQ está associada à <span class="math inline">\(n_c - 1\)</span> graus de liberdade. Dessa forma, podemos obter uma estimativa do “erro puro”, ou seja, independente do modelo adotado</p>
<pre class="r"><code>(MQpuro &lt;- SQpuro/(nc-1))
# [1] 0.043</code></pre>
<p>Agora podemos calcular a SQ devido à curvatura, ou à falta de ajuste, conforme mostrado anteriormente</p>
<pre class="r"><code>## lof = lack of fit
(SQlof &lt;- (nf * nc * (mean(yc) - mean(yf))^2)/(nf + nc))
# [1] 0.002722222</code></pre>
<p>que possui apneas um grau de liberdade (portanto SQlof = MQlof). Como vimos, o teste F para a falta de ajuste vem da razão entre MQlof e MQpuro</p>
<pre class="r"><code>(Flof &lt;- SQlof/MQpuro)
# [1] 0.06330749
## Calculando o p-valor associado, temos
pf(Flof, 1, nc - 1, lower.tail = FALSE)
# [1] 0.8137408</code></pre>
<p>Ou seja, não rejeitamos a hipótese de que o modelo linear é adequado (ou de que não existe falta de ajuste).</p>
<p>Fazendo através das funções do R, podemos adotar a seguinte abordagem:</p>
<pre class="r"><code>## Modelo desconsiderando os pontos centrais
m0 &lt;- lm(Rendimento ~ Tempo * Temperatura, data = dados,
         subset = Tempo != 0)
anova(m0)
# Warning in anova.lm(m0): ANOVA F-tests on an essentially perfect fit are
# unreliable
# Analysis of Variance Table
# 
# Response: Rendimento
#                   Df Sum Sq Mean Sq F value Pr(&gt;F)
# Tempo              1 2.4025  2.4025               
# Temperatura        1 0.4225  0.4225               
# Tempo:Temperatura  1 0.0025  0.0025               
# Residuals          0 0.0000</code></pre>
<p>Note que dessa forma não temos uma estimativa do erro.</p>
<pre class="r"><code>## Modelo considerando os pontos centrais
m1 &lt;- lm(Rendimento ~ Tempo * Temperatura, data = dados)
anova(m1)
# Analysis of Variance Table
# 
# Response: Rendimento
#                   Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
# Tempo              1 2.40250 2.40250 68.7520 0.0004166 ***
# Temperatura        1 0.42250 0.42250 12.0906 0.0177127 *  
# Tempo:Temperatura  1 0.00250 0.00250  0.0715 0.7997870    
# Residuals          5 0.17472 0.03494                      
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Mesmo sem repetição dos fatores, obtemos uma estimativa do erro devido às repetições do ponto central. Mas note que essa estimativa pode ser viesada pois não consideramos um termo quadrático no modelo para incorporar a falta de ajuste. Caso não exista falta de ajuste, ou seja o modelo linear é adequado, então esta estimativa está correta (não viesada). Mas se o modelo linear não for adequado a estimativa será viesada. Para incluir um termo que define a falta de ajuste podemos criar uma nova variável indicadora para os pontos fatoriais e os pontos centrais. Obtemos esse termo elevendo qualquer coluna de fator ao quadrado:</p>
<pre class="r"><code>dados$lof &lt;- dados$Tempo^2</code></pre>
<p>lof aqui significa “lack of fit”. Note que essa coluna somente indica quais observações são dos eixos fatoriais e quais são do ponto central</p>
<pre class="r"><code>dados
#   Tempo Temperatura Rendimento lof
# 1    -1          -1       39.3   1
# 2     1          -1       40.9   1
# 3    -1           1       40.0   1
# 4     1           1       41.5   1
# 5     0           0       40.3   0
# 6     0           0       40.5   0
# 7     0           0       40.7   0
# 8     0           0       40.2   0
# 9     0           0       40.6   0</code></pre>
<p>Isso irá fazer com que a média do plano fatorial ({y}_f) seja contrastada com a média do plano dos pontos centrais ({y}_c). Agora podemos ajustar um novo modelo com esse termo</p>
<pre class="r"><code>m2 &lt;- lm(Rendimento ~ Tempo * Temperatura + lof, data = dados)
anova(m2)
# Analysis of Variance Table
# 
# Response: Rendimento
#                   Df  Sum Sq Mean Sq F value   Pr(&gt;F)   
# Tempo              1 2.40250 2.40250 55.8721 0.001713 **
# Temperatura        1 0.42250 0.42250  9.8256 0.035030 * 
# lof                1 0.00272 0.00272  0.0633 0.813741   
# Tempo:Temperatura  1 0.00250 0.00250  0.0581 0.821316   
# Residuals          4 0.17200 0.04300                    
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>O ideal é que a SQlof seja a última linha do quadro de ANOVA, porém, como nesses modelos existe ortogonalidade entre os efeitos, isso deixa de ter importância. Note que o teste F para SQlof está de fato testando se esse termo é importante, ou em outras palavras, se a diferença entre as médias dos eixos dos fatores é significativa. Um TRV entre os modelos com e sem lof mostra o mesmo resultado.</p>
<pre class="r"><code>anova(m2, m1)
# Analysis of Variance Table
# 
# Model 1: Rendimento ~ Tempo * Temperatura + lof
# Model 2: Rendimento ~ Tempo * Temperatura
#   Res.Df     RSS Df  Sum of Sq      F Pr(&gt;F)
# 1      4 0.17200                            
# 2      5 0.17472 -1 -0.0027222 0.0633 0.8137</code></pre>
<p>Nesse caso, não rejeitamos a hipótese de que essas médias são iguas e concluimos que não há falta de ajuste, e que o modelo linear é adequado. Assim, podemos redefinir o modelo sem esse termo</p>
<pre class="r"><code>mf &lt;- update(m2, . ~ . -lof)
anova(mf)
# Analysis of Variance Table
# 
# Response: Rendimento
#                   Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
# Tempo              1 2.40250 2.40250 68.7520 0.0004166 ***
# Temperatura        1 0.42250 0.42250 12.0906 0.0177127 *  
# Tempo:Temperatura  1 0.00250 0.00250  0.0715 0.7997870    
# Residuals          5 0.17472 0.03494                      
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Como a interação também é não significativa, então também a retiramos do modelo</p>
<pre class="r"><code>mf &lt;- update(mf, . ~ . -Tempo:Temperatura)
anova(mf)
# Analysis of Variance Table
# 
# Response: Rendimento
#             Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
# Tempo        1 2.40250 2.40250  81.339 0.000104 ***
# Temperatura  1 0.42250 0.42250  14.304 0.009158 ** 
# Residuals    6 0.17722 0.02954                     
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Dessa forma temos uma estimativa de erro não viesada e um modelo parcimonioso para descrever o processo.</p>
<p>Podemos então avaliar os resíduos e fazer as predições:</p>
<pre class="r"><code>##----------------------------------------------------------------------
## Residuos do modelo
res &lt;- residuals(mf)
## Quantis normais
qqnorm(res); qqline(res)</code></pre>
<p><img src="figures/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>## Resíduo vs preditor
par(mfrow = c(1, 2))
with(dados, {
    plot(res ~ Tempo)
    abline(h = 0, lty = 2, col = 2)
    plot(res ~ Temperatura)
    abline(h = 0, lty = 2, col = 2)
})</code></pre>
<p><img src="figures/unnamed-chunk-15-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>par(mfrow = c(1, 1))

##----------------------------------------------------------------------
## Predições

## Predição para as combinações únicas dos fatores
pred &lt;- data.frame(Tempo = dados$Tempo,
                   Temperatura = dados$Temperatura)
pred$y &lt;- predict(mf, newdata = pred)
pred
#   Tempo Temperatura        y
# 1    -1          -1 39.34444
# 2     1          -1 40.89444
# 3    -1           1 39.99444
# 4     1           1 41.54444
# 5     0           0 40.44444
# 6     0           0 40.44444
# 7     0           0 40.44444
# 8     0           0 40.44444
# 9     0           0 40.44444
## Verifica a projeção
proj(mf)
#   (Intercept)         Tempo Temperatura    Residuals
# 1    40.44444 -7.750000e-01      -0.325 -0.044444444
# 2    40.44444  7.750000e-01      -0.325  0.005555556
# 3    40.44444 -7.750000e-01       0.325  0.005555556
# 4    40.44444  7.750000e-01       0.325 -0.044444444
# 5    40.44444  2.775558e-17       0.000 -0.144444444
# 6    40.44444  2.775558e-17       0.000  0.055555556
# 7    40.44444  2.775558e-17       0.000  0.255555556
# 8    40.44444  2.775558e-17       0.000 -0.244444444
# 9    40.44444  2.775558e-17       0.000  0.155555556
# attr(,&quot;df&quot;)
# (Intercept)       Tempo Temperatura   Residuals 
#           1           1           1           6 
# attr(,&quot;formula&quot;)
# Rendimento ~ Tempo + Temperatura
# attr(,&quot;onedf&quot;)
# [1] FALSE
cbind(pred, yproj = apply(proj(mf)[,-4], 1, sum))
#   Tempo Temperatura        y    yproj
# 1    -1          -1 39.34444 39.34444
# 2     1          -1 40.89444 40.89444
# 3    -1           1 39.99444 39.99444
# 4     1           1 41.54444 41.54444
# 5     0           0 40.44444 40.44444
# 6     0           0 40.44444 40.44444
# 7     0           0 40.44444 40.44444
# 8     0           0 40.44444 40.44444
# 9     0           0 40.44444 40.44444

## Predição para um intervalo de valores entre os níveis baixo e alto
## dos fatores
pred &lt;- expand.grid(Tempo = seq(-1, 1, length.out = 30),
                    Temperatura = seq(-1, 1 ,length.out = 30))
pred$y &lt;- predict(mf, newdata = pred)
## Vários formas de visualizar
wireframe(y ~ Tempo + Temperatura, data = pred, drape = TRUE)</code></pre>
<p><img src="figures/unnamed-chunk-15-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>levelplot(y ~ Tempo + Temperatura, data = pred, cuts = 90,
          col.regions = heat.colors)</code></pre>
<p><img src="figures/unnamed-chunk-15-4.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="fatorial-25-5-pontos-centrais" class="section level2">
<h2>Fatorial <span class="math inline">\(2^5\)</span> + 5 pontos centrais</h2>
<p>Um experimento foi realizado em uma planta de fabricação de semicondutores, como um esforço para aumentar o rendimento. Cinco fatores, cada um com dois níveis, foram estudados. Os fatores (e níveis) foram A = abertura (peq, grande), B = tempo de exposição (20% abaixo, 20% acima do valor nominal), C = tempo de desenvolvimento (30, 40 s), D = dimensão da máscara (peq, grande), e E = tempo de ataque químico (14.5, 15.5 min). Foi realizado um planejamento 2^5 + 5 pontos centrais. Com isso:</p>
<ol style="list-style-type: lower-alpha">
<li>Construa um gráfico de probabilidade normal dos efeitos estimados. Que efeitos parecem ser grandes?</li>
<li>Conduza a análise de variância para confirmar suas descobertas do item (a).</li>
<li>Estime o erro experimental usando os pontos centrais e conduza a análise de variância para testar a falta de ajuste.</li>
<li>Avalie os pressupostos por meio de análise gráfica dos resíduos.</li>
<li>Projete o planejamento <span class="math inline">\(2^5\)</span> deste problema em um planejamento <span class="math inline">\(2^k\)</span>, <span class="math inline">\(k&lt;5\)</span>, nos fatores importantes.</li>
</ol>
<pre class="r"><code>##----------------------------------------------------------------------
## Dados e definições
url &lt;- &quot;http://www.leg.ufpr.br/~fernandomayer/data/montgomery_14-17.txt&quot;
da &lt;- read.csv(url, sep = &quot;\t&quot;)
str(da)
# &#39;data.frame&#39;: 37 obs. of  6 variables:
#  $ A: int  -1 1 -1 1 -1 1 -1 1 -1 1 ...
#  $ B: int  -1 -1 1 1 -1 -1 1 1 -1 -1 ...
#  $ C: int  -1 -1 -1 -1 1 1 1 1 -1 -1 ...
#  $ D: int  -1 -1 -1 -1 -1 -1 -1 -1 1 1 ...
#  $ E: int  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
#  $ Y: int  7 9 34 55 16 20 40 60 8 10 ...
r &lt;- 1
k &lt;- 5

##----------------------------------------------------------------------
## a) Gráfico q-q dos efeitos
tab &lt;- model.matrix(~ A * B * C * D * E, data = da)
contr &lt;- t(tab[, -1]) %*% da$Y
(ef &lt;- contr/(r * 2^(k-1)))
#              [,1]
# A         11.8125
# B         33.9375
# C          9.6875
# D         -0.8125
# E          0.4375
# A:B        7.9375
# A:C        0.4375
# B:C        0.0625
# A:D       -0.0625
# B:D       -0.6875
# C:D        0.8125
# A:E        0.9375
# B:E        0.5625
# C:E        0.3125
# D:E       -1.1875
# A:B:C     -0.4375
# A:B:D      0.3125
# A:C:D     -0.4375
# B:C:D      0.4375
# A:B:E     -0.1875
# A:C:E      0.3125
# B:C:E      0.9375
# A:D:E      0.8125
# B:D:E      0.1875
# C:D:E     -0.8125
# A:B:C:D   -0.0625
# A:B:C:E    0.1875
# A:B:D:E    0.9375
# A:C:D:E   -0.3125
# B:C:D:E   -0.9375
# A:B:C:D:E -0.1875
aux &lt;- qqnorm(ef, col = 2, pch = 19); qqline(ef)
text(aux$x, aux$y, rownames(aux$y), cex = 0.8, pos = 3)</code></pre>
<p><img src="figures/mont1417-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
##----------------------------------------------------------------------
## b) Análise de variância para confirmar impressões de (a)
m0 &lt;- lm(Y ~ (A + B + C + D + E)^2, data = da)
anova(m0)
# Analysis of Variance Table
# 
# Response: Y
#           Df Sum Sq Mean Sq  F value    Pr(&gt;F)    
# A          1 1116.3  1116.3  30.5794 1.735e-05 ***
# B          1 9214.0  9214.0 252.4089 3.534e-13 ***
# C          1  750.8   750.8  20.5669 0.0001808 ***
# D          1    5.3     5.3   0.1447 0.7074976    
# E          1    1.5     1.5   0.0419 0.8396929    
# A:B        1  504.0   504.0  13.8074 0.0012791 ** 
# A:C        1    1.5     1.5   0.0419 0.8396929    
# A:D        1    0.0     0.0   0.0009 0.9769347    
# A:E        1    7.0     7.0   0.1926 0.6652323    
# B:C        1    0.0     0.0   0.0009 0.9769347    
# B:D        1    3.8     3.8   0.1036 0.7507528    
# B:E        1    2.5     2.5   0.0693 0.7948652    
# C:D        1    5.3     5.3   0.1447 0.7074976    
# C:E        1    0.8     0.8   0.0214 0.8850856    
# D:E        1   11.3    11.3   0.3090 0.5841460    
# Residuals 21  766.6    36.5                       
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

##----------------------------------------------------------------------
## c) Avaliar se existe falta de ajuste

## Separa os pontos fatoriais dos centrais e calcula tamanho das
## amostras
yf &lt;- da$Y[da$A != 0] # y dos pontos fatoriais
yc &lt;- da$Y[da$A == 0] # y do ponto central (0,0)
(nf &lt;- length(yf))
# [1] 32
(nc &lt;- length(yc))
# [1] 5
## Médias
c(mean(yf), mean(yc))
# [1] 30.53125 43.20000
diff(c(mean(yf), mean(yc)))
# [1] 12.66875
## Erro experimental usando pontos centrais
(SQpuro &lt;- sum((yc - mean(yc))^2))
# [1] 32.8
(MQpuro &lt;- SQpuro/(nc-1))
# [1] 8.2

## Teste para falta de ajuste
da$lof &lt;- da$A^2
m1 &lt;- lm(Y ~ (A + B + C + D + E)^2 + lof, data = da)
anova(m1)
# Analysis of Variance Table
# 
# Response: Y
#           Df Sum Sq Mean Sq   F value    Pr(&gt;F)    
# A          1 1116.3  1116.3  307.7274 1.299e-13 ***
# B          1 9214.0  9214.0 2540.0500 &lt; 2.2e-16 ***
# C          1  750.8   750.8  206.9693 5.185e-12 ***
# D          1    5.3     5.3    1.4559   0.24166    
# E          1    1.5     1.5    0.4221   0.52327    
# lof        1  694.0   694.0  191.3279 1.062e-11 ***
# A:B        1  504.0   504.0  138.9473 1.863e-10 ***
# A:C        1    1.5     1.5    0.4221   0.52327    
# A:D        1    0.0     0.0    0.0086   0.92697    
# A:E        1    7.0     7.0    1.9383   0.17914    
# B:C        1    0.0     0.0    0.0086   0.92697    
# B:D        1    3.8     3.8    1.0424   0.31946    
# B:E        1    2.5     2.5    0.6978   0.41339    
# C:D        1    5.3     5.3    1.4559   0.24166    
# C:E        1    0.8     0.8    0.2154   0.64760    
# D:E        1   11.3    11.3    3.1099   0.09309 .  
# Residuals 20   72.5     3.6                        
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
anova(m0, m1)
# Analysis of Variance Table
# 
# Model 1: Y ~ (A + B + C + D + E)^2
# Model 2: Y ~ (A + B + C + D + E)^2 + lof
#   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
# 1     21 766.59                                  
# 2     20  72.55  1    694.04 191.33 1.062e-11 ***
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

##----------------------------------------------------------------------
## d) Avaliação dos pressupostos
## Para o modelo sem lof
res.m0 &lt;- residuals(m0)
qqnorm(res.m0); qqline(res.m0)</code></pre>
<p><img src="figures/mont1417-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
## Para o modelo com lof
res.m1 &lt;- residuals(m1)
qqnorm(res.m1); qqline(res.m1)</code></pre>
<p><img src="figures/mont1417-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>
##----------------------------------------------------------------------
## e) Projeção do experimento
## Os fatores D e E podem ser desconsiderados nos próximos ensaios. Então reduz-se o estudo
## à 3 fatores.
## Modelo final, mantendo apenas fatores importantes
mf &lt;- lm(Y ~ A + B + C + A:B + lof, data = da)
anova(mf)
# Analysis of Variance Table
# 
# Response: Y
#           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
# A          1 1116.3  1116.3  309.96 &lt; 2.2e-16 ***
# B          1 9214.0  9214.0 2558.45 &lt; 2.2e-16 ***
# C          1  750.8   750.8  208.47 2.622e-15 ***
# lof        1  694.0   694.0  192.71 7.567e-15 ***
# A:B        1  504.0   504.0  139.95 5.010e-13 ***
# Residuals 31  111.6     3.6                      
# ---
# Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Note que o experimento foi reduzido para um fatorial <span class="math inline">\(2^3\)</span>. Devido a existência de falta de ajuste, o planejamento dos próximos experimentos deve permitir estimar efeitos quadráticos. Pode-se usar, por exemplo, experimentos fatoriais com pontos centrais e axiais (metodologia de superfície de resposta).</p>
<p>Note também que a inclusão da coluna <code>lof</code> não significa que estamos ajustando um modelo com termos quadráticos (de segunda ordem). Essa coluna serve apenas para indicar um contraste entre duas médias (dos pontos fatoriais e centrais) e testar se existe falta de ajuste. Caso a falta de ajuste exista, então devemos <strong>planejar</strong> o próximo experimento de forma que seja possível estimar termos quadráticos.</p>
</div>
</div>
<div id="exercicios" class="section level1">
<h1>Exercícios</h1>
<ol style="list-style-type: decimal">
<li><p>(Montgomery, EAPE, ex. 14-23) Considere um experimento fatorial <span class="math inline">\(2^2\)</span> com 4 pontos centrais. Os dados estão disponíveis <a href="http://leg.ufpr.br/~fernandomayer/data/montgomery_ex_14-23.txt">aqui</a>. Calcule uma ANOVA com a soma de quadrados para a curvatura, faça a seleção do modelo e verifique se existe falta de ajuste.</p></li>
<li><p>(Montgomery, ICEQ, exemplo 13.9) Um artigo em <em>Solid State Technology</em> descreve a aplicação de planejamentos fatoriais no desenvolvimento de um processo de gravação por nitreto em um gravador de plasma de placa única. O processo usa <span class="math inline">\(C_2F_6\)</span> como o gás reagente. Os autores usaram uma única replicação de um planejamento <span class="math inline">\(2^4\)</span> para estudar esse processo. Os fatores testados foram: espaçamento (A-: 0.8, A+: 1.2), pressão (B-: 450, B+: 550), fluxo de <span class="math inline">\(C_2F_6 (C-: 125, C+: 200)\)</span>, potência (D-: 275, D+: 325). Foram também adicionados 4 pontos centrais. Os dados estão disponíveis <a href="http://leg.ufpr.br/~fernandomayer/data/montgomery_ICEQ_ex_13.9.csv">aqui</a>. Faça a ANOVA, avalie o modelo e verifique se existe falta de ajuste.</p></li>
</ol>
<p>As respostas podem ser consultadas neste <a href="scripts/fatorial_pontos-centrais_respostas.R">script</a>.</p>
</div>

<center>
  <hr width="100%" size="3px">
  <p> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.pt_BR">
      <img src="img/CC_by-nc-sa_80x15.png" alt="Licença Creative Commons 4.0"> </a>
  </p>
  <p> <font size="2"> Este conteúdo
      está disponível por meio da Licença Creative Commons 4.0 </font>
  </p>
</center>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
